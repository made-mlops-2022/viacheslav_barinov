# Домашнее задание 2 по курсу Машинное обучение в продакшене

Пример использования. Запуск докера производится из директории с проектом.  

Существует 2 пути для создания docker image:
- Собрать docker image на локальной машине можно командой
    ~~~
    docker build -t faust7/faust7_server -f online_inference/Dockerfile .
    ~~~

- Загрузить docker image из https://hub.docker.com/ можно командой
    ~~~
    docker pull faust7/faust7_server
    ~~~

Запустить контейнер можно командой
~~~
docker run --rm -p 8000:8000 faust7/faust7_server
~~~

В новом окне терминала из директории online_inference запускается скрипт, отправляющий запросы
~~~
python make_request.py 
~~~

Для обучения модели использован небольшой датасет для классификации https://www.kaggle.com/datasets/cherngs/heart-disease-cleveland-uci.

**Основная часть**

- [x] Оберните inference вашей модели в rest сервис на FastAPI, должен быть endpoint /predict (3 балла)
- [x] Напишите endpoint /health (1 балл), должен возращать 200, если ваша модель готова к работе (такой чек особенно актуален если делаете доп задание про скачивание из хранилища) 
- [x] Напишите unit тест для /predict  (3 балла) (https://fastapi.tiangolo.com/tutorial/testing/, https://flask.palletsprojects.com/en/1.1.x/testing/)

- [x] Напишите скрипт, который будет делать запросы к вашему сервису -- 2 балла

- [x] Напишите dockerfile, соберите на его основе образ и запустите локально контейнер (docker build, docker run), внутри контейнера должен запускать сервис, написанный в предущем пункте, закоммитьте его, напишите в readme корректную команду сборки (4 балл)

- [x] опубликуйте образ в https://hub.docker.com/, используя docker push (вам потребуется зарегистрироваться) (+2 балла)

- [x] напишите в readme корректные команды docker pull/run, которые должны привести к тому, что локально поднимется на inference ваша модель (1 балл)
   Убедитесь, что вы можете протыкать его скриптом из пункта 3

- [x] проведите самооценку (распишите в реквесте какие пункты выполнили и на сколько баллов, укажите сумму баллов) -- 1 балл

**Дополнительная часть**: 
1) Ваш сервис скачивает модель из S3 или любого другого хранилища при старте, путь для скачивания передается через переменные окружения (+2 доп балла)
2) Оптимизируйте размер docker image (+2 доп балла) (опишите в readme.md что вы предприняли для сокращения размера и каких результатов удалось добиться -- должно получиться мини исследование, я сделал тото и получился такой-то результат)
https://docs.docker.com/develop/develop-images/dockerfile_best-practices/
3) Сделайте валидацию входных данных https://pydantic-docs.helpmanual.io/usage/validators/
    (например, порядок колонок не совпадает с трейном, типы, допустимые максимальные и минимальные значения, проявите фантазию, это доп. баллы, проверка не должна быть тривиальной)  (вы можете сохранить вместе с моделью доп информацию, о структуре входных данных, если это нужно) -- 2 доп балла
https://fastapi.tiangolo.com/tutorial/handling-errors/ -- возращайте 400, в случае, если валидация не пройдена
